<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>متجر المعرفة للمنتجات الرقمية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #0c1427; color: #e0e0e0; }
        .card { background-color: #1a2942; }
        .btn-secondary { background-color: transparent; color: #fbbf24; border: 1px solid #fbbf24; }
        .page-content { display: none; }
        #home.page-content { display: block; }
        .nav-link.active { color: #fbbf24; font-weight: bold; }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="bg-gray-900/50 backdrop-blur-sm sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" data-page="home" class="text-xl md:text-2xl font-bold text-white flex items-center">
                <i data-lucide="lightbulb" class="ml-3 text-amber-400"></i>
                <div><span class="text-amber-400">متجر</span> المعرفة</div>
            </a>
            <nav id="main-nav" class="hidden md:flex items-center space-x-8 space-x-reverse text-lg">
                <a href="#" data-page="home" class="nav-link active">الرئيسية</a>
                <a href="#" data-page="products" class="nav-link">المنتجات</a>
                <a href="#" data-page="admin" id="admin-nav-link" class="nav-link hidden bg-amber-400 text-gray-900 px-3 py-1 rounded-md">لوحة التحكم</a>
            </nav>
        </div>
    </header>

    <main>
        <!-- Store Pages -->
        <div id="home" class="page-content py-20 text-center">
            <h1 class="text-5xl font-bold mb-4">أهلاً بك في متجر المعرفة</h1>
            <p class="text-xl mb-8">بوابتك إلى عالم من الإلهام.</p>
            <a href="#" data-page="products" class="bg-amber-400 text-gray-900 font-bold py-3 px-8 rounded-lg">تصفح المنتجات</a>
        </div>
        <div id="products" class="page-content py-20">
             <div class="container mx-auto px-6">
                <h3 class="text-4xl font-bold text-center mb-12">منتجاتنا</h3>
                <div id="products-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10"></div>
            </div>
        </div>

        <!-- Admin Panel Page -->
        <section id="admin" class="page-content bg-gray-100 text-gray-800 py-10">
            <div class="container mx-auto px-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold">إدارة المنتجات</h2>
                    <button id="logout-button" class="text-red-600 hover:underline">تسجيل الخروج</button>
                </div>
                <div class="bg-white p-8 rounded-lg shadow-md mb-8">
                    <h3 class="text-2xl font-bold mb-6">إضافة منتج جديد</h3>
                    <form id="add-product-form">
                        <div class="mb-4"><label for="product-name" class="block font-bold mb-2">اسم المنتج</label><input type="text" id="product-name" class="w-full px-4 py-2 border rounded-lg" required></div>
                        <div class="mb-4"><label for="product-price" class="block font-bold mb-2">السعر</label><input type="number" id="product-price" class="w-full px-4 py-2 border rounded-lg" required></div>
                        <div class="mb-4"><label for="product-description" class="block font-bold mb-2">الوصف</label><textarea id="product-description" rows="3" class="w-full px-4 py-2 border rounded-lg" required></textarea></div>
                        <div class="mb-4"><label for="product-image" class="block font-bold mb-2">رابط الصورة</label><input type="url" id="product-image" class="w-full px-4 py-2 border rounded-lg" required></div>
                        <div class="text-left"><button type="submit" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg">إضافة المنتج</button></div>
                    </form>
                </div>
                <div class="bg-white p-8 rounded-lg shadow-md">
                    <h3 class="text-2xl font-bold mb-6">المنتجات الحالية</h3>
                    <div id="admin-products-list" class="space-y-4"></div>
                </div>
            </div>
        </section>
    </main>
    
    <footer class="bg-gray-900 text-white mt-20">
        <div class="container mx-auto px-6 py-8">
            <div id="auth-container" class="text-center">
                 <button id="login-button" class="btn-secondary font-bold py-2 px-4 rounded-lg">تسجيل دخول الأدمن</button>
            </div>
        </div>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const firebaseConfig = {
                apiKey: "AIzaSyAK1uQl1yvfch7j5UCOQFDDMAuBWOY9w8",
                authDomain: "maarifa-store.firebaseapp.com",
                projectId: "maarifa-store",
                storageBucket: "maarifa-store.appspot.com",
                messagingSenderId: "940520390427",
                appId: "1:940520390427:web:1aaea5c259bdd94de9dbe",
                measurementId: "G-QRLNHK0DKK"
            };

            const app = firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            const auth = firebase.auth();
            const googleProvider = new firebase.auth.GoogleAuthProvider();

            const allPages = document.querySelectorAll('.page-content');
            const navLinks = document.querySelectorAll('[data-page]');
            const storeProductsGrid = document.getElementById('products-grid');
            const addProductForm = document.getElementById('add-product-form');
            const adminProductsList = document.getElementById('admin-products-list');
            const adminNavLink = document.getElementById('admin-nav-link');
            const loginButton = document.getElementById('login-button');
            const logoutButton = document.getElementById('logout-button');
            
            const ADMIN_UID = "mAnDCGDQLXX2kTjkmbTUhp2D5lR2";

            function showPage(pageId) {
                if (!pageId || !document.getElementById(pageId)) return;
                allPages.forEach(p => p.style.display = 'none');
                document.getElementById(pageId).style.display = 'block';
                document.querySelectorAll('.nav-link').forEach(l => l.classList.toggle('active', l.dataset.page === pageId));
            }

            loginButton.addEventListener('click', () => auth.signInWithPopup(googleProvider));
            logoutButton.addEventListener('click', () => auth.signOut());

            auth.onAuthStateChanged(user => {
                const isAdmin = user && user.uid === ADMIN_UID;
                loginButton.style.display = user ? 'none' : 'block';
                adminNavLink.style.display = isAdmin ? 'block' : 'none';
                if (!isAdmin && document.getElementById('admin').style.display === 'block') showPage('home');
            });

            function renderStoreProducts() {
                db.collection("products").onSnapshot(snapshot => {
                    storeProductsGrid.innerHTML = '';
                    if (snapshot.empty) { storeProductsGrid.innerHTML = '<p class="col-span-full text-center">لا توجد منتجات حالياً.</p>'; return; }
                    snapshot.forEach(doc => {
                        const product = { id: doc.id, ...doc.data() };
                        const card = document.createElement('div');
                        card.className = 'card rounded-lg shadow-lg overflow-hidden';
                        card.innerHTML = `<img src="${product.image}" alt="${product.name}" class="w-full h-56 object-cover"><div class="p-6"><h3 class="font-bold text-xl mb-2">${product.name}</h3><p class="text-gray-400 text-sm mb-4">${product.description}</p><div class="text-left"><span class="font-bold text-2xl text-amber-400">${product.price} ر.س</span></div></div>`;
                        storeProductsGrid.appendChild(card);
                    });
                }, error => console.error("Error fetching store products:", error));
            }

            function renderAdminProducts() {
                db.collection("products").onSnapshot(snapshot => {
                    adminProductsList.innerHTML = '';
                    if (snapshot.empty) { adminProductsList.innerHTML = '<p class="text-center">لا توجد منتجات.</p>'; return; }
                    snapshot.forEach(doc => {
                        const product = doc.data();
                        const item = document.createElement('div');
                        item.className = 'flex justify-between items-center bg-gray-200 p-3 rounded-lg text-gray-800';
                        item.innerHTML = `<span>${product.name}</span><button class="text-red-600 hover:underline delete-btn" data-id="${doc.id}">حذف</button>`;
                        adminProductsList.appendChild(item);
                    });
                }, error => console.error("Error fetching admin products:", error));
            }

            addProductForm.addEventListener('submit', e => {
                e.preventDefault();
                const productData = {
                    name: document.getElementById('product-name').value,
                    price: parseFloat(document.getElementById('product-price').value),
                    description: document.getElementById('product-description').value,
                    image: document.getElementById('product-image').value,
                };
                db.collection("products").add(productData).then(() => {
                    alert('تم إضافة المنتج بنجاح!');
                    addProductForm.reset();
                }).catch(err => console.error(err));
            });

            adminProductsList.addEventListener('click', e => {
                if (e.target.classList.contains('delete-btn')) {
                    const id = e.target.dataset.id;
                    if (confirm('هل أنت متأكد من حذف هذا المنتج؟')) {
                        db.collection("products").doc(id).delete().then(() => alert('تم الحذف!'));
                    }
                }
            });

            lucide.createIcons();
            navLinks.forEach(el => el.addEventListener('click', e => { 
                e.preventDefault(); 
                showPage(el.dataset.page); 
            }));
            
            renderStoreProducts();
            renderAdminProducts();
        });
    </script>
</body>
</html>
